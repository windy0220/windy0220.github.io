<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Laravel学习手记 · 大马的个人网站</title><meta name="description" content="Laravel学习手记 - 大马"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://bigma.cc/atom.xml" title="大马的个人网站"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avater.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">日志</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/1000/01/01/实验室/" target="_self" class="nav-list-link">实验室</a></li><li class="nav-list-item"><a href="http://weibo.com/80yang" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/windy0220" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Laravel学习手记</h1><div class="post-info">2017年10月18日</div><div class="post-content"><p>安装Laravel的Homestead开发环境<br>请参考 <a href="https://bigma.cc/2017/08/08/Homestead/">Windows下搭建Laravel的Homestead开发环境</a></p>
<h1 id="搭建本地环境"><a href="#搭建本地环境" class="headerlink" title="搭建本地环境"></a>搭建本地环境</h1><p>1.下载安装</p>
<p>Study<br>2.下载安装composer<br>3.下载 <a href="https://github.com/laravel/laravel/archive/master.zip" target="_blank" rel="noopener">最新版Laravel框架</a><br>4.解压到网站目录 这里统一命名为laravel<br>5.phpStudy 添加一个网站 laravel.app 路径指向你网站目录的 laravel\public 下<br>6.本地Host 文件添加一行 laravel.app 127.0.0.1<br>7.网站目录下的 laravel.env.example 文件复制改名 .env</p>
<blockquote>
<p>tips: windows下是无法创建改.env文件的，可以在vscode中创建，一定要创建啊，要不然打开会报500 错误</p>
</blockquote>
<p>8.将以下内容添加到 composer.json 文件中 请参考 <a href="https://pkg.phpcomposer.com/" target="_blank" rel="noopener">https://pkg.phpcomposer.com/</a> 这样就能使用中国的composer镜像了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"repositories"</span>: &#123;</span><br><span class="line">    <span class="string">"packagist"</span>: &#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"composer"</span>,</span><br><span class="line">        <span class="string">"url"</span>: <span class="string">"https://packagist.phpcomposer.com"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9.在根目录执行 composer install 等待安装完成<br>10.打开浏览器输入 laravel.app </p>
<p>如果出现 <code>The only supported ciphers are AES-128-CBC and AES-256-CBC with the correct key lengths.</code>的错误<br>请在网站目录中执行以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan key:generate</span><br></pre></td></tr></table></figure></p>
<p>11.在 Nginx 配置文件中加入  不加会导致请求api的时候404<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$query_string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h1><p>laravel/.env<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DB_CONNECTION=mysql   <span class="comment">#数据库类型</span></span><br><span class="line">DB_HOST=127.0.0.1     <span class="comment">#数据库地址</span></span><br><span class="line">DB_PORT=3306          <span class="comment">#端口</span></span><br><span class="line">DB_DATABASE=homestead <span class="comment">#数据库名</span></span><br><span class="line">DB_USERNAME=homestead <span class="comment">#数据库用户名</span></span><br><span class="line">DB_PASSWORD=secret    <span class="comment">#数据库密码</span></span><br></pre></td></tr></table></figure></p>
<h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><p>laravel\routes\web.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//请求 /user 路径，访问 UserController 控制器中的 index 方法</span></span><br><span class="line">Route::get(<span class="string">'/user'</span>, <span class="string">'UserController@index'</span>);</span><br></pre></td></tr></table></figure></p>
<h4 id="路由参数"><a href="#路由参数" class="headerlink" title="路由参数"></a>路由参数</h4><p>当然，有时需要在路由中捕获一些 URL 片段。例如，从 URL 中捕获用户的 ID，可以通过定义路由参数来执行此操作：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'user/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'User '</span>.$id;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>也可以根据需要在路由中定义多个参数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'posts/&#123;post&#125;/comments/&#123;comment&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($postId, $commentId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>可选参数</strong><br>有时，你可能需要指定一个路由参数，但你希望这个参数是可选的。你可以在参数后面加上 ? 标记来实现，但前提是要确保路由的相应变量有默认值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'user/&#123;name?&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($name = null)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $name;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'user/&#123;name?&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($name = <span class="string">'John'</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $name;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//需在控制器对应的方法中接收参数</span></span><br><span class="line">Route::get(<span class="string">'/user/&#123;name?&#125;'</span>, <span class="string">'UserController@index'</span>);</span><br><span class="line"><span class="comment">//控制器中的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">($name)</span></span>&#123;</span><br><span class="line"> some code...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="路由组"><a href="#路由组" class="headerlink" title="路由组"></a>路由组</h4><p><strong>路由前缀</strong><br>可以用 prefix 方法为路由组中给定的 URL 增加前缀。例如，你可以为组中所有路由的 URI 加上 admin 前缀：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::prefix(<span class="string">'admin'</span>)-&gt;group(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    Route::get(<span class="string">'users'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 匹配包含 "/admin/users" 的 URL</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>命名空间</strong><br>另一个常见用例是使用 namespace 方法将相同的 PHP 命名空间分配给路由组的中所有的控制器：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::namespace(<span class="string">'Admin'</span>)-&gt;group(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Route::get(<span class="string">'test'</span>, <span class="string">'TController@test'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在 App\Http\Controllers 新建一个文件夹 Admin 其下新建一个 TConroller.php<br> TConroller.php 内容<br> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Admin</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"命名空间路由测试"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="any"><a href="#any" class="headerlink" title="any"></a>any</h4><p>如何页面是一个表单，既需要展示有需要post数据，可以使用 any<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::any(<span class="string">'admin/cate/edit/&#123;id&#125;'</span>, <span class="string">'Admin\CateController@update'</span>);</span><br></pre></td></tr></table></figure></p>
<p>在控制器中需要先判断是 get 还是 post 来执行不同的命令<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(Request $request, $id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($request-&gt;isMethod(<span class="string">'get'</span>)) &#123; <span class="comment">//判断 Method 方式</span></span><br><span class="line">        $row = CateModel::where([<span class="string">'id'</span>=&gt;$id])-&gt;first()-&gt;toArray();</span><br><span class="line">        $cate = CateModel::tree();</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">'admin.cate.edit'</span>, [<span class="string">'row'</span> =&gt; $row, <span class="string">'cateRow'</span>=&gt;$cate]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $data = $request-&gt;except(<span class="string">'_token'</span>);</span><br><span class="line">        CateModel::where([<span class="string">'id'</span>=&gt;$id])-&gt;update($data);</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'admin/cate/list'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>请记住，默认情况下，RouteServiceProvider 会在命名空间组中引入你的路由文件，让你不用指定完整的 App\Http\Controllers 命名空间前缀就能注册控制器路由。因此，你只需要指定命名空间 App\Http\Controllers 之后的部分。</p>
<p>路由的其他使用方法 <a href="https://d.laravel-china.org/docs/5.5/routing" target="_blank" rel="noopener">https://d.laravel-china.org/docs/5.5/routing</a></p>
<h1 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h1><p>1.控制器定义在 laravel\app\Http\Controllers\ 下<br>2.使用命名空间，注意命名空间大小写，首字母大写 namespace App\Http\Controllers;<br>3.定义的控制器类必须继承基础控制器 Controller<br>4.必须先定义好路由<br>新建 UserController.php 控制器文件 类名需与文件名保持一致<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $sql = <span class="string">'select * from user'</span>;</span><br><span class="line">        $rows = DB::select($sql);</span><br><span class="line">        <span class="comment">// DD($rows);</span></span><br><span class="line">        <span class="comment">// return "Hello";</span></span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">'list'</span>, [<span class="string">'rows'</span>=&gt;$rows]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用 view(‘list’, [‘rows’=&gt;$rows]) 调用 list 视图 通过数组传参<br>使用 dd($rows) 来打印数据<br>使用 DB来访问数据库控制方法</p>
<h1 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h1><p>重定向响应是类 Illuminate\Http\RedirectResponse 的实例, 包含了重定向用户到其他 URL 所需要的合适头信息。有很多方式生成 RedirectResponse 实例。最简单的方法是使用全局的 redirect 辅助函数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'dashboard'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'home/dashboard'</span>);</span><br><span class="line">    <span class="comment">//重定向到本地</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/student'</span>);</span><br><span class="line">    <span class="comment">//跨域重定向</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'http://www.baidu.com'</span>);</span><br><span class="line">    <span class="comment">//使用门面类调转 不推荐使用</span></span><br><span class="line">    <span class="keyword">return</span> Redirect::to(<span class="string">'/student'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>重定向到控制器</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> redirect()-&gt;action(<span class="string">'HomeController@index'</span>);</span><br><span class="line"><span class="comment">//传递参数</span></span><br><span class="line"><span class="keyword">return</span> redirect()-&gt;action(</span><br><span class="line">    <span class="string">'UserController@profile'</span>, [<span class="string">'id'</span> =&gt; <span class="number">1</span>]</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong> 使用 action 方法跳转到控制器对应的方法，需要事先在路由中注册该方法</p>
<h1 id="response"><a href="#response" class="headerlink" title="response"></a>response</h1><h4 id="返回-json-数据"><a href="#返回-json-数据" class="headerlink" title="返回 json 数据"></a>返回 json 数据</h4><p><strong><br>1.必须使用 response() 函数<br>2.必须使用 return 返回
</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponseController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rj</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $data = [<span class="string">"name"</span> =&gt; <span class="string">"laowang"</span> , <span class="string">"age"</span> =&gt; <span class="number">18</span>];</span><br><span class="line">        <span class="keyword">return</span> response()-&gt;json($data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">down</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response()-&gt;download(<span class="string">"D:/phpStudy/WWW/laravel/public/avatar.jpg"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="request"><a href="#request" class="headerlink" title="request"></a>request</h1><p>$request-&gt;method() 获取当前 http 请求的方法<br>$request-&gt;isMethod(“get”) 判断当前 http 请求的方法是否为 get<br>$request-&gt;url() 返回当前的url 不包括参数 使用 $request-&gt;参数 可获取到参数的值<br>$request-&gt;all() 获取post提交的表单数据 提交表单必须添加token <figure class="highlight plain"><figcaption><span>type</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$request-&gt;input(&quot;参数/表单元素名&quot;) 单独获取表单中元素名的值</span><br><span class="line">```php</span><br><span class="line">&lt;?php</span><br><span class="line">namespace App\Http\Controllers;</span><br><span class="line"></span><br><span class="line">use Illuminate\Http\Request;</span><br><span class="line"></span><br><span class="line">class RequestController extends Controller</span><br><span class="line">&#123;</span><br><span class="line">    public function req(Request  $request)&#123;</span><br><span class="line">        dd($request-&gt;id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function add(Request  $request)&#123;</span><br><span class="line">        dd($request-&gt;all());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips:<br>1.使用 Request 类之前，必须 use 载入该类 use Illuminate\Http\Request;<br>2.函数中，使用 Request 类名约束形式参数</p>
<h1 id="使用命令行创建控制器"><a href="#使用命令行创建控制器" class="headerlink" title="使用命令行创建控制器"></a>使用命令行创建控制器</h1><p>在 laravel 目录下执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可显示 help 信息</span></span><br><span class="line">$ D:/phpStudy/php70n/php.exe artisan</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建控制器</span></span><br><span class="line">$ D:/phpStudy/php70n/php.exe artisan make:controller PhotoController</span><br></pre></td></tr></table></figure></p>
<h1 id="Restfull-风格控制器"><a href="#Restfull-风格控制器" class="headerlink" title="Restfull 风格控制器"></a>Restfull 风格控制器</h1><p>创建控制器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 restfull 风格控制器 （将PHP.exe加入环境变量则可以直接使用 php artisan）</span></span><br><span class="line">$ php artisan make:controller TestController --resource</span><br></pre></td></tr></table></figure></p>
<p>使用专用路由<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::resource(<span class="string">'photo'</span>,<span class="string">'PhotoController'</span>);</span><br></pre></td></tr></table></figure></p>
<p>使用一下命令查看路由表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan route:list</span><br><span class="line"></span><br><span class="line">+--------+-----------+--------------------+---------------+----------------------------------------------+--------------+</span><br><span class="line">| Domain | Method    | URI                | Name          | Action                                       | Middleware   |</span><br><span class="line">+--------+-----------+--------------------+---------------+----------------------------------------------+--------------+</span><br><span class="line">|        | GET|HEAD  | photo              | photo.index   | App\Http\Controllers\PhotoController@index   | web          |</span><br><span class="line">|        | POST      | photo              | photo.store   | App\Http\Controllers\PhotoController@store   | web          |</span><br><span class="line">|        | GET|HEAD  | photo/create       | photo.create  | App\Http\Controllers\PhotoController@create  | web          |</span><br><span class="line">|        | GET|HEAD  | photo/&#123;photo&#125;      | photo.show    | App\Http\Controllers\PhotoController@show    | web          |</span><br><span class="line">|        | PUT|PATCH | photo/&#123;photo&#125;      | photo.update  | App\Http\Controllers\PhotoController@update  | web          |</span><br><span class="line">|        | DELETE    | photo/&#123;photo&#125;      | photo.destroy | App\Http\Controllers\PhotoController@destroy | web          |</span><br><span class="line">|        | GET|HEAD  | photo/&#123;photo&#125;/edit | photo.edit    | App\Http\Controllers\PhotoController@edit    | web          |</span><br><span class="line">+--------+-----------+--------------------+---------------+----------------------------------------------+--------------+</span><br></pre></td></tr></table></figure></p>
<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><p>视图新建在 resources/views/ 目录下，为PHP文件<br>使用 view(“视图文件名”, [“参数名”=&gt; “参数值”]) 调用视图文件。多级目录使用 folder.folder.viewname 的形式<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShowController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">'test.show'</span>, [<span class="string">'name'</span>=&gt;<span class="string">'Hello'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="使用DB调用数据"><a href="#使用DB调用数据" class="headerlink" title="使用DB调用数据"></a>使用DB调用数据</h4><p>先配置好数据库连接<br>新建 list.php 视图文件 通过 echo $rows 显示数据<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;姓名&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;年龄&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        <span class="meta">&lt;?php</span> <span class="keyword">foreach</span>($rows <span class="keyword">as</span> $row)&#123; <span class="meta">?&gt;</span></span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $row-&gt;id; <span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $row-&gt;user; <span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $row-&gt;age; <span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        <span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>控制器文件<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $sql = <span class="string">'select * from user'</span>;</span><br><span class="line">        $rows = DB::select($sql);</span><br><span class="line">        <span class="comment">// DD($rows);</span></span><br><span class="line">        <span class="comment">// return "Hello";</span></span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">'list'</span>, [<span class="string">'rows'</span>=&gt;$rows]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="blade模版"><a href="#blade模版" class="headerlink" title="blade模版"></a>blade模版</h4><p>在 resources/views/ 目录下新建 viewname.blade.php 的 blade 模版<br><strong>变量输出</strong><br><figure class="highlight plain"><figcaption><span>```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">**执行函数**</span><br><span class="line">可执行 PHP 和 Laravel 函数</span><br><span class="line">``` &#123;&#123;print_r($name)&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>三元表达式</strong><br><figure class="highlight plain"><figcaption><span>? $name : 'Default'&#125;&#125; ```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">blade 模版的三元表达式</span><br><span class="line">&#123;&#123;$name or &apos;Default&apos;&#125;&#125;</span><br><span class="line">**输出原始数据（不转义HTML）**</span><br><span class="line">&#123;!!$name!!&#125;</span><br><span class="line">**循环语句**</span><br><span class="line">```php</span><br><span class="line">@for ($i = 0; $i &lt; 10; $i++)</span><br><span class="line">    目前的值为 &#123;&#123; $i &#125;&#125;</span><br><span class="line">@endfor</span><br><span class="line"></span><br><span class="line">@foreach ($users as $user)</span><br><span class="line">    &lt;p&gt;此用户为 &#123;&#123; $user-&gt;id &#125;&#125;&lt;/p&gt;</span><br><span class="line">@endforeach</span><br></pre></td></tr></table></figure></p>
<p><a href="https://d.laravel-china.org/docs/5.5/blade#loops" target="_blank" rel="noopener">https://d.laravel-china.org/docs/5.5/blade#loops</a></p>
<p><strong>if语句</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span> (count($records) === <span class="number">1</span>)</span><br><span class="line">    我有一条记录！</span><br><span class="line">@<span class="keyword">elseif</span> (count($records) &gt; <span class="number">1</span>)</span><br><span class="line">    我有多条记录！</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line">    我没有任何记录！</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure></p>
<p><a href="https://d.laravel-china.org/docs/5.5/blade#if-statements" target="_blank" rel="noopener">https://d.laravel-china.org/docs/5.5/blade#if-statements</a></p>
<p><strong>区块划分语句</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建 top 区块 并立即显示</span></span><br><span class="line">@section(<span class="string">"top"</span>)</span><br><span class="line">somecode</span><br><span class="line">@show</span><br><span class="line"></span><br><span class="line"><span class="comment">//只创建 top 区块</span></span><br><span class="line">@section(<span class="string">"top"</span>)</span><br><span class="line">somecode</span><br><span class="line">@endsection</span><br><span class="line"></span><br><span class="line"><span class="comment">//引用 top 区块</span></span><br><span class="line">@<span class="keyword">yield</span>(<span class="string">"top"</span>)</span><br></pre></td></tr></table></figure></p>
<p><strong>继承模版</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@extends(<span class="string">"template.master"</span>)</span><br></pre></td></tr></table></figure></p>
<p><strong>component 组件使用</strong><br>定义组件<br>新建一个 component1.blade.php 文件<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>='<span class="title">component</span>'&gt;</span></span><br><span class="line">    &lt;!-- $title，$content 变量实际上就是预定义的插槽 --&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>='<span class="title">title</span>'&gt;</span>&#123;&#123; $title &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>='<span class="title">content</span>'&gt;</span>&#123;&#123; $content &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>使用组件<br>@slot 传递变量<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@component(<span class="string">'blade.component1'</span>) <span class="comment">//括号中为组件的路径</span></span><br><span class="line">    @slot(<span class="string">'title'</span>)</span><br><span class="line">        组件标题 <span class="comment">//为组件中的 &#123;&#123;$title&#125;&#125; 传值</span></span><br><span class="line">    @endslot</span><br><span class="line">    </span><br><span class="line">    @slot(<span class="string">'content'</span>)</span><br><span class="line">        组件内容</span><br><span class="line">    @endslot</span><br><span class="line">@endcomponent</span><br></pre></td></tr></table></figure></p>
<p>渲染JSON内容<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = @json($array);</span><br></pre></td></tr></table></figure></p>
<p>输出存在的变量<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有时候你想要输出一个变量，但是不确定该变量是否被设置，我们可以通过如下 PHP 代码：</span></span><br><span class="line">&#123; <span class="keyword">isset</span>($name) ? $name : <span class="string">'Default'</span> &#125;&#125;</span><br><span class="line"><span class="comment">// 除了使用三元运算符，Blade 还提供了更简单的方式： 如果 $name 变量存在，其值将会显示，否则将会显示 Default。</span></span><br><span class="line">&#123;&#123; $name <span class="keyword">or</span> <span class="string">'Default'</span> &#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>Blade &amp; JavaScript 框架<br>Vue也使用双花括号，所以使用 @ 符号来告诉 Blade 渲染引擎该表达式应该保持原生格式不作改动，使Vue能正确渲染<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Laravel&lt;/h1&gt;</span><br><span class="line">Hello, @&#123;&#123; name &#125;&#125;.</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 verbatim 此块中的代码不会被blade渲染。</span></span><br><span class="line">@verbatim</span><br><span class="line">    &lt;div class="container"&gt;</span><br><span class="line">        Hello, &#123;&#123; name &#125;&#125;.</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">@endverbatim</span><br></pre></td></tr></table></figure></p>
<p>认证指令<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@auth 和 @guest 指令可用于快速判断当前用户是否登录：</span></span><br><span class="line"></span><br><span class="line">@auth</span><br><span class="line">    <span class="comment">// 用户已登录...</span></span><br><span class="line">@endauth</span><br><span class="line"></span><br><span class="line">@guest</span><br><span class="line">    <span class="comment">// 用户未登录...</span></span><br><span class="line">@endguest</span><br><span class="line"><span class="comment">//如果需要的话，你也可以在使用 @auth 和 @guest 的时候指定登录用户类型：</span></span><br><span class="line"></span><br><span class="line">@auth(<span class="string">'admin'</span>)</span><br><span class="line">    <span class="comment">// The user is authenticated...</span></span><br><span class="line">@endauth</span><br><span class="line"></span><br><span class="line">@guest(<span class="string">'admin'</span>)</span><br><span class="line">    <span class="comment">// The user is not authenticated...</span></span><br><span class="line">@endguest</span><br></pre></td></tr></table></figure></p>
<p>注释</p>
<p>Blade 还允许你在视图中定义注释，然而，不同于 HTML 注释，Blade 注释并不会包含到 HTML 中被返回：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;-- This comment will not be present in the rendered HTML --&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>PHP</p>
<p>在一些场景中，嵌入 PHP 代码到视图中很有用，你可以使用 @php 指令在模板中执行一段原生 PHP 代码：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@php</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">@endphp</span><br></pre></td></tr></table></figure></p>
<h1 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h1><p>模型用来对数据库进行操作。<br>创建 Model<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php artisan make:model Models/UserModel</span><br></pre></td></tr></table></figure></p>
<p>UserModel 将创建在 laravel/app/Models 目录下<br><strong>Tips</strong></p>
<ol>
<li>namespace 每个目录名大写</li>
<li>使用基础模型类 use Illuminate\Database\Eloquent\Model;</li>
<li>需要使用成员属性 $table 指定表名</li>
<li>如果该表的主键非 id ，需要使用 $primaryKey 指定该表的主键 </li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UserModel.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModel</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $table=<span class="string">"admin"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h4><p>新建控制器 UserController.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">UserModel</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">select</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	<span class="comment">//查询所有数据</span></span><br><span class="line">        $row = UserModel::all();   </span><br><span class="line">        dd($row);</span><br><span class="line">        <span class="comment">//使用 get()-&gt;toArray() 将查询的数据集转换成数组</span></span><br><span class="line">        $row = UserModel::get() -&gt;toArray();</span><br><span class="line">        dd($row);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//where 进行条件查询 first() 表示取出第一天数据</span></span><br><span class="line">        $user = UserModel::where(<span class="string">'user'</span>, <span class="string">'老王'</span>)-&gt;first();</span><br><span class="line">        dd($user);</span><br><span class="line">        <span class="comment">//使用 $user-&gt;id 取出成员id</span></span><br><span class="line">        dd($user-&gt;id);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//使用 value 函数直接取出值</span></span><br><span class="line">        $user = UserModel::where(<span class="string">'user'</span>, <span class="string">'老王'</span>)-&gt;value(<span class="string">'id'</span>);</span><br><span class="line">        dd($user);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//选择字段取值</span></span><br><span class="line">        $user = UserModel::where(<span class="string">'user'</span>, <span class="string">'老王'</span>)-&gt;select(<span class="string">'user'</span>, <span class="string">'age'</span>)-&gt;get()-&gt;toArray();</span><br><span class="line">        dd($user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>插入数据</strong><br>Tips<br>1.Laravel 默认的插入方式需要表中有 updated_at 和 created_at 字段（timestamp类型） 用来保存更新和创建时间。关闭方法为在 Model 中添加 <figure class="highlight plain"><figcaption><span>$timestamps </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.使用数组形式插入数据需要在 Model 中定义哪些字段可以插入 ```php protected $fillable = [&apos;user&apos;, &apos;age&apos;];</span><br></pre></td></tr></table></figure></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//单条插入</span></span><br><span class="line">        $user = <span class="keyword">new</span> UserModel();</span><br><span class="line">        $user-&gt;user = <span class="string">"老马"</span>;</span><br><span class="line">        $user-&gt;age = <span class="string">"16"</span>;</span><br><span class="line">        $user-&gt;save();</span><br><span class="line"></span><br><span class="line">        dd($user-&gt;id);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//数组插入</span></span><br><span class="line">        $user-&gt;fill([<span class="string">'user'</span>=&gt;<span class="string">"小马"</span>, <span class="string">"age"</span> =&gt; <span class="number">16</span>]);</span><br><span class="line">        $user-&gt;save();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//一次插入多条数据</span></span><br><span class="line">        UserModel::insert([</span><br><span class="line">            [<span class="string">'user'</span>=&gt;<span class="string">"小马2"</span>, <span class="string">"age"</span> =&gt; <span class="number">16</span>],</span><br><span class="line">            [<span class="string">'user'</span>=&gt;<span class="string">"小马3"</span>, <span class="string">"age"</span> =&gt; <span class="number">16</span>],</span><br><span class="line">            [<span class="string">'user'</span>=&gt;<span class="string">"小马4"</span>, <span class="string">"age"</span> =&gt; <span class="number">16</span>],</span><br><span class="line">            [<span class="string">'user'</span>=&gt;<span class="string">"小马5"</span>, <span class="string">"age"</span> =&gt; <span class="number">16</span>],</span><br><span class="line">            [<span class="string">'user'</span>=&gt;<span class="string">"小马6"</span>, <span class="string">"age"</span> =&gt; <span class="number">16</span>]</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>更新数据</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//更新数据</span></span><br><span class="line">        $user = UserModel::where([<span class="string">'id'</span>=&gt;<span class="string">'1'</span>])-&gt;first();</span><br><span class="line">        $user-&gt;user = <span class="string">"老李"</span>;</span><br><span class="line">        $user-&gt;save();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新形式2</span></span><br><span class="line">        UserModel::where([<span class="string">'id'</span>=&gt;<span class="string">'1'</span>])-&gt;update([<span class="string">'user'</span>=&gt;<span class="string">'老毛桃'</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>删除数据</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">        UserModel::where([<span class="string">'id'</span>=&gt;<span class="string">'2'</span>])-&gt;delete();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>一对一查询</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ArticleModel</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Cate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//id 表示分类表中的 id 字段 ，cate 表示文章表中的 cate 字段</span></span><br><span class="line">    <span class="comment">//使用文章表中的 cate 字段 查出 对应分类表id 字段的数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasOne(<span class="string">'App\Models\Admin\CateModel'</span>, <span class="string">'id'</span>, <span class="string">'cate'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ArticleModel</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getlist</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $rows = ArticleModel::get();</span><br><span class="line">        <span class="comment">//dd($row[0]-&gt;Cate-&gt;name);//取出name值</span></span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">'admin.list'</span>, [<span class="string">'rows'</span> =&gt; $rows]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>View 模版<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">foreach</span>($rows <span class="keyword">as</span> $row)</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                &lt;th scope=<span class="string">"row"</span>&gt;&#123;&#123;$row-&gt;id&#125;&#125;&lt;/th&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123;$row-&gt;title&#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123;$row-&gt;Cate-&gt;name&#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href="/admin/article/edit/&#123;&#123;$row['id']&#125;&#125;"&gt;&lt;span class="glyphicon glyphicon-edit" aria-hidden="true"&gt;&lt;/span&gt;&lt;/a&gt; | &lt;span class="glyphicon glyphicon-remove-sign" aria-hidden="true"&gt;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br></pre></td></tr></table></figure></p>
<p><strong>一对多查询</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CateModel</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Articles</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//在分类模型中 使用一对多 通过传入的分类 id 匹配 ArticleModel 的 cate 字段 获取多篇文章</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(<span class="string">'App\Models\Admin\ArticleModel'</span>, <span class="string">'cate'</span>, <span class="string">'id'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//CateController</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//使用 分类 查出多条文章 一对多查询 </span></span><br><span class="line">        $cate = CateModel::find($id) -&gt; Articles() -&gt;get() -&gt; toArray();</span><br><span class="line">        dd($cate);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>基本分页</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$rows = ArticleModel::get();</span></span><br><span class="line"><span class="comment">//基本分页</span></span><br><span class="line">$rows = ArticleModel::simplePaginate(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//带页码分页</span></span><br><span class="line">$rows = ArticleModel::Paginate(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//模版</span></span><br><span class="line"> &#123;!! $rows-&gt;render()!!&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h1><p>在 blade 模版中使用 <figure class="highlight plain"><figcaption><span>可引用 public 目录下的文件。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用 Hash::check(&apos;明文&apos;, &apos;密文&apos;);</span><br><span class="line"></span><br><span class="line"># Session</span><br><span class="line">#### 一次性Session</span><br><span class="line">```php</span><br><span class="line">$request-&gt;session()-&gt;flash(&apos;message&apos;, &apos;账号密码错误&apos;);</span><br></pre></td></tr></table></figure></p>
<h1 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">使用 Hash 需要先引用</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Hash</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//加密</span></span><br><span class="line">Hash::make($password)]</span><br><span class="line"><span class="comment">//对比</span></span><br><span class="line">Hash::check($password, $user-&gt;password)</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2018/02/24/Vue-Cli学习手记/" class="prev">PREV</a><a href="/2017/08/09/Hexo踩坑日志/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ma-chen-cn';
var disqus_identifier = '2017/10/18/Laravel学习手记/';
var disqus_title = 'Laravel学习手记';
var disqus_url = 'http://bigma.cc/2017/10/18/Laravel学习手记/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ma-chen-cn.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2023 <a href="http://bigma.cc">大马</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>. <a href="https://beian.miit.gov.cn/" target="_blank">冀ICP备13002956号-1</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-116335564-1",'auto');ga('send','pageview');</script></body></html>