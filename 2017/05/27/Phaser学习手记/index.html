<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Phaser学习手记 · 大马的个人网站</title><meta name="description" content="Phaser学习手记 - 大马"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://bigma.cc/atom.xml" title="大马的个人网站"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avater.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">日志</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/1000/01/01/实验室/" target="_self" class="nav-list-link">实验室</a></li><li class="nav-list-item"><a href="http://weibo.com/80yang" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/windy0220" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Phaser学习手记</h1><div class="post-info">2017年5月27日</div><div class="post-content"><h2 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Phaser.Game(width, height, renderer, parent, state, transparent, antialias, physicsConfig);</span><br></pre></td></tr></table></figure>
<p>例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var game = new Phaser.Game(300, 400, Phaser.AUTO, container);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">width <span class="comment">//游戏宽度</span></span><br><span class="line">height <span class="comment">//游戏高度</span></span><br><span class="line">renderer <span class="comment">//游戏渲染方式 Phaser.CANVAS/Phaser.WEBGL/Phaser.AUTO</span></span><br><span class="line">parent<span class="comment">//游戏的容器 DOM元素或ID</span></span><br><span class="line">state <span class="comment">//游戏默认场景</span></span><br><span class="line">transparent <span class="comment">//画布元素是否透明</span></span><br><span class="line">antialias <span class="comment">//是否开启抗锯齿</span></span><br><span class="line">physicsConfig <span class="comment">//物理引擎配置</span></span><br></pre></td></tr></table></figure>
<h2 id="Game对象属性"><a href="#Game对象属性" class="headerlink" title="Game对象属性"></a>Game对象属性</h2><p>暂停游戏<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">game.Paused = true</span><br></pre></td></tr></table></figure></p>
<p>运行游戏<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">game.Paused = false</span><br></pre></td></tr></table></figure></p>
<p>其他属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">game.add; <span class="comment">//是对游戏对象工厂的一个引用</span></span><br><span class="line">game.camera; <span class="comment">//是游戏中摄像机对象的引用</span></span><br><span class="line">game.input; <span class="comment">//是游戏中的用户交互事件对象的引用</span></span><br><span class="line">game.load; <span class="comment">//是游戏资源加载模块的引用</span></span><br><span class="line">game.scale; <span class="comment">//是游戏缩放模块的引用</span></span><br><span class="line">game.sound; <span class="comment">//是游戏声音模块的引用</span></span><br><span class="line">game.stage; <span class="comment">//是游戏舞台对象的引用</span></span><br><span class="line">game.particles; <span class="comment">//是游戏粒子系统的引用</span></span><br><span class="line">game.physics; <span class="comment">//是游戏物理系统的引用</span></span><br><span class="line">game.state; <span class="comment">//是游戏场景管理对象的引用</span></span><br></pre></td></tr></table></figure>
<h2 id="State-场景"><a href="#State-场景" class="headerlink" title="State 场景"></a>State 场景</h2><p><strong>创建场景对象 Phaser.State 的两种形式</strong></p>
<p>对象形式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">    preload: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>函数形式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">    <span class="keyword">this</span>.preload = funtion()&#123;&#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>preload, create, update, render 至少要存在一个</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">init(); <span class="comment">//场景初始化代码</span></span><br><span class="line">preload(); <span class="comment">//加载游戏资源</span></span><br><span class="line">create(); <span class="comment">//创建游戏显示对象或注册时间等</span></span><br><span class="line">update(); <span class="comment">//游戏每一帧都会调用</span></span><br><span class="line">render(); <span class="comment">//游戏每一个渲染周期都会调用 默认一帧就是一个渲染周期</span></span><br></pre></td></tr></table></figure>
<h2 id="Phaser-StateManager场景管理对象"><a href="#Phaser-StateManager场景管理对象" class="headerlink" title="Phaser.StateManager场景管理对象"></a>Phaser.StateManager场景管理对象</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> game = <span class="keyword">new</span> Phaser.Game();</span><br><span class="line">game.state.add(name, state); <span class="comment">//添加场景（场景名称，场景对象）</span></span><br><span class="line">game.state.start(name); <span class="comment">//运行启动场景</span></span><br></pre></td></tr></table></figure>
<h2 id="Phaser-Loader-加载游戏资源"><a href="#Phaser-Loader-加载游戏资源" class="headerlink" title="Phaser.Loader 加载游戏资源"></a>Phaser.Loader 加载游戏资源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">game.load.image(); //加载图片</span><br><span class="line">game.load.spritesheet(); //加载图片集 需小图尺寸一致</span><br><span class="line">game.load.atlas(); //加载图片集 大小不同 尺寸不一</span><br><span class="line">game.load.audio(); //加载声音</span><br><span class="line">game.load.audiosprite(); //加载声音集</span><br><span class="line">game.load.text(); //加载文本文件</span><br><span class="line">game.load.xml(); //加载XML文件</span><br><span class="line">game.load.binary(); //加载二进制文件</span><br></pre></td></tr></table></figure>
<p><strong>Loader事件</strong></p>
<p>单个资源加载完成事件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">game.load.onFileComlete.add(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//单个资源加载成功后调用该事件</span></span><br><span class="line">    <span class="keyword">var</span> progress =game.load.progress;<span class="comment">//使用game.load.progress 来获取所有资源的加载进度1表示1%</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>所有资源加载完成事件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">game.load.onLoadComplete.add(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="Phaser-Stage舞台"><a href="#Phaser-Stage舞台" class="headerlink" title="Phaser.Stage舞台"></a>Phaser.Stage舞台</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var game = new Phaser.Game();</span><br><span class="line">//使用game.stage来引用舞台对象</span><br><span class="line">//改变舞台的背景颜色 十六进制颜色0xffffff 舞台默认黑色</span><br><span class="line">game.stage.setBackgroundColor(backgroundColor);</span><br></pre></td></tr></table></figure>
<h2 id="Phaser-World-世界"><a href="#Phaser-World-世界" class="headerlink" title="Phaser.World 世界"></a>Phaser.World 世界</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//设置世界边界的大小</span><br><span class="line">game.world.setBounds(x, y, width, heigint);</span><br></pre></td></tr></table></figure>
<h2 id="Phaser-Camera"><a href="#Phaser-Camera" class="headerlink" title="Phaser.Camera"></a>Phaser.Camera</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">game.camera.x = 100; //改变摄像机在X轴上的位置</span><br><span class="line">game.camera.y = 100; //改变摄像机在Y轴上的位置</span><br><span class="line">game.camera.focusOn(displayObject); //让摄像机定位到物体上</span><br><span class="line">game.camera.focusOnxy(x, y); //让摄像机定位到x, y这个坐标上</span><br><span class="line">game.camera.follow(target); //让摄像机跟随目标物体target</span><br><span class="line"></span><br><span class="line">sprite.fixedToCamera = true;//精灵固定到摄像机</span><br><span class="line">sprite.cameraOffset.setTo(200, 500);//相对于摄像机的偏移</span><br></pre></td></tr></table></figure>
<h2 id="游戏的缩放控制"><a href="#游戏的缩放控制" class="headerlink" title="游戏的缩放控制"></a>游戏的缩放控制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//可以使用game.scale 来引用当前游戏的Phaser.ScaleManager对象</span><br><span class="line">//之后可以使用 scaleMode 属性来改变缩放模式</span><br><span class="line">game.scale.scaleMode = Phaser.ScaleManager.EXACT_FIT;</span><br></pre></td></tr></table></figure>
<p>缩放模式</p>
<blockquote>
<p>EXACT_FIT 缩放到父元素的大小，可能会改变宽高比</p>
</blockquote>
<blockquote>
<p>SHOW_ALL 保持宽高比缩放到父元素的大小 一般用这个</p>
</blockquote>
<blockquote>
<p>USER_SCALE 自定义缩放 需要使用 game.scale.setUserScale(0.5, 0.5) 设定</p>
</blockquote>
<p>缩放配置可以放到init方法中</p>
<p><strong>水平和垂直居中</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">game.scale.pageAlignHorizontally = true; //水平居中</span><br><span class="line">game.scale.pageAlignVertically = true; //垂直居中</span><br></pre></td></tr></table></figure></p>
<h2 id="文字"><a href="#文字" class="headerlink" title="文字"></a>文字</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">game.add.text(x, y, text, style, group);</span><br></pre></td></tr></table></figure>
<p>style文字样式设置的3种方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var text = game.add.text(0, 0, &quot;Hello&quot;, Style); //添加文字时以对象的方式设置 可以直接设置或引用设置</span><br><span class="line">Style =&#123;</span><br><span class="line">    font: &quot;bold 24px Arial&quot;,</span><br><span class="line">    fill: &quot;#fff&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">text.style.fill = &quot;#fff&quot;; //通过文字的styel对象设置</span><br><span class="line"></span><br><span class="line">text.fill = &quot;#fff&quot;; //在文字对象上直接设置</span><br></pre></td></tr></table></figure></p>
<p>文字样式属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">text.fill = &apos;#fff&apos;; //文字颜色</span><br><span class="line">text.font = &apos;微软雅黑&apos;; //字体</span><br><span class="line">text.fontSize = 60; //字号</span><br><span class="line">text.fontWeight = &apos;normal&apos;;  //粗细 默认加粗</span><br><span class="line">text.style.backgroundColor = &apos;#0f0&apos;; //背景颜色 必须通过style对象设置</span><br><span class="line">text.stroke = &apos;#f00&apos;; //描边颜色</span><br><span class="line">text.strokeThickness = 10; //描边宽度</span><br><span class="line">text.wordWrap = true; //自动换行</span><br><span class="line">text.wordWrapWidth = 150; //超过设定宽度 自动换行 wordWrap必须为true</span><br></pre></td></tr></table></figure></p>
<h2 id="特殊字体"><a href="#特殊字体" class="headerlink" title="特殊字体"></a>特殊字体</h2><p>3种特殊字体<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">webFont //类似于css的用法 需要先激活（建立一个dom容器 设定该容器的字体为webFont即可激活），因为加载字体需要一定的时间，使用Phaser 时可用setTimeout延迟加载。</span><br><span class="line"></span><br><span class="line">BitmapText //图片文字 一般用这个</span><br><span class="line"></span><br><span class="line">RetroFont //同BitmapText</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>BitmapText 文字制作工具</strong></p>
</blockquote>
<ul>
<li>BMFont (Windows, free): <a href="http://www.angelcode.com/products/bmfont/" target="_blank" rel="noopener">http://www.angelcode.com/products/bmfont/</a></li>
<li>Glyph Designer (OS X, commercial): <a href="http://www.71squared.com/en/glyphdesigner" target="_blank" rel="noopener">http://www.71squared.com/en/glyphdesigner</a></li>
<li><strong>Littera (Web-based, free): <a href="http://kvazars.com/littera/" target="_blank" rel="noopener">http://kvazars.com/littera/</a></strong></li>
</ul>
<blockquote>
<p>Littera的使用</p>
</blockquote>
<ol>
<li>先点击左侧的FONT Select Font 选择一个本地字体进行上传</li>
<li>在上方Included glyphs 输入框中输入需要的所有文字</li>
<li>使用 Fill Stroke 等进行样式的编辑</li>
<li>在上方导出栏里设置导出格式为XML（默认）点击Export导出</li>
</ol>
<blockquote>
<p>BitmapText 的使用</p>
</blockquote>
<p>preload方法中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">game.load.bitmapFont(&apos;font&apos;, &apos;asset/font.png&apos;, &apos;asset/font.fnt&apos;); //&apos;定义资源名称&apos;, &apos;文字图片路径&apos;, &apos;文字图片配置文件&apos;</span><br></pre></td></tr></table></figure></p>
<p>create方法中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var text = game.add.bitmapText(0, 0, &apos;font&apos;, &apos;Hello&apos;, 30);//x坐标, y坐标, 资源名称, 文字内容, 文字大小</span><br></pre></td></tr></table></figure></p>
<h2 id="组"><a href="#组" class="headerlink" title="组"></a>组</h2><p>Phaser.world 是最顶层的组</p>
<blockquote>
<p>创建组</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var group = game.add.group();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>给组添加子元素的几种方法</p>
</blockquote>
<ul>
<li>创建图片或精灵时指定组</li>
<li>group.add(key) 方法直接添加 (资源名称)</li>
<li>group.create(x, y, ‘key’, frame?, exists?) 方法创建子元素并添加进组 (x坐标, y坐标, 资源名称, 帧, 是否显示)</li>
</ul>
<blockquote>
<p>组的操作</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">group.alpha = 0.5; //透明度</span><br><span class="line">group.x = 100; //x坐标</span><br><span class="line">group.scale.set(0.5); //缩放</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><ul>
<li>Phaser.Tween 补间动画</li>
<li>Phaser.Animation 逐帧动画</li>
</ul>
<h4 id="补间动画"><a href="#补间动画" class="headerlink" title="补间动画"></a>补间动画</h4><blockquote>
<p>创建补间动画</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var tween = game.add.tween(boject);</span><br><span class="line">tween.to(propertis, duration, ease, autoStart, delay, repeat, yoyo);//当前过渡到指定</span><br><span class="line">tween.from(propertis, duration, ease, autoStart, delay, repeat, yoyo);//指定过渡到当前</span><br><span class="line"></span><br><span class="line">propertis //状态属性集合 &#123;x:300, y:200&#125;</span><br><span class="line"></span><br><span class="line">duration //持续时间 毫秒</span><br><span class="line">ease //缓动函数 参照文档 docs/src_tween_TweenManager.js.html easeMap部分</span><br><span class="line">autoStart //是否自动开始</span><br><span class="line">delay //延迟</span><br><span class="line">repeat //重复次数 -1无限次</span><br><span class="line">yoyo //是否反向执行</span><br></pre></td></tr></table></figure>
<blockquote>
<p>补间动画操作方法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tween.start(); //开始</span><br><span class="line">tween.stop(); //停止</span><br><span class="line">tween.pause(); //暂停</span><br><span class="line">tween.resume(); //恢复</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用方法 在create方法中</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var phaser = game.add.image(0, 0, &apos;phaser&apos;);</span><br><span class="line">var tween = game.add.tween(phaser);</span><br><span class="line">tween.to(&#123;y:300&#125;, 2000, Phaser.Easing.Bounce.Out, true, 0, 100, true);</span><br><span class="line">tween.from(&#123;y:300&#125;, 2000, Phaser.Easing.Bounce.Out, true, 0, 100, true);</span><br></pre></td></tr></table></figure>
<h4 id="逐帧动画"><a href="#逐帧动画" class="headerlink" title="逐帧动画"></a>逐帧动画</h4><p>需要使用game.load.spritesheet 加载雪碧精灵图片且每个精灵大小相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var sprite = game.add.sprite();</span><br><span class="line"></span><br><span class="line">//定义动画</span><br><span class="line">sprite.animations.add(name, frames);</span><br><span class="line"></span><br><span class="line">//播放动画</span><br><span class="line">sprite.animations.play(name, frameRate, loop, killOnComplete);</span><br><span class="line"></span><br><span class="line">//停止动画</span><br><span class="line">sprite.animations.stop(name);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//preload方法中</span><br><span class="line">game.load.spritesheet(&apos;man&apos;, &apos;asset/man.png&apos;, 136, 152); //(&apos;key&apos;, &apos;资源路径&apos;, 每帧宽度, 每帧高度)</span><br><span class="line"></span><br><span class="line">//create方法中</span><br><span class="line">var man = game.add.sprite(0, 0, &apos;man&apos;);</span><br><span class="line"></span><br><span class="line">man.animations.add(&apos;run&apos;, [26,27,28,29,30]);//(&apos;定义动画名称&apos;, 动画所需的帧)</span><br><span class="line"></span><br><span class="line">man.animations.play(&apos;run&apos;, 60, true);//(&apos;要播放的动画名称&apos;, 每秒帧数, 是否循环)</span><br></pre></td></tr></table></figure>
<h2 id="Atlas"><a href="#Atlas" class="headerlink" title="Atlas"></a>Atlas</h2><p>Atlas每一帧大小可以不固定</p>
<p>使用 <a href="http://renderhjs.net/shoebox/" target="_blank" rel="noopener">http://renderhjs.net/shoebox/</a> 将图片拖到程序的Sprite Sheet上，生成XML格式的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//preload方法中</span><br><span class="line">game.load.atlasXML(&apos;man&apos;, &apos;asset/atlas.png&apos;, &apos;asset/atlas.xml&apos;);// (key, 图片资源地址, xml文件地址)</span><br><span class="line"></span><br><span class="line">//create方法同spritesheet动画 其中帧可以使用xml中帧的name值</span><br></pre></td></tr></table></figure>
<h2 id="粒子系统"><a href="#粒子系统" class="headerlink" title="粒子系统"></a>粒子系统</h2><blockquote>
<p>粒子发射器的创建</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var emitter = game.add.emitter(x?, y?, maxParticles?); //(x坐标, y坐标, 粒子在屏幕上显示的最大数量)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建粒子</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emitter.makeParticles(keys, frames?, quantity?, collide?, collideWorldBounds?);//(名称, 帧数, 要产生多少粒子, 粒子之间/粒子跟边界是否碰撞)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实例</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//preload</span><br><span class="line">game.load.image(&apos;bubble&apos;, &apos;asset/bubble.png&apos;);</span><br><span class="line"></span><br><span class="line">//create</span><br><span class="line">//粒子发射器的创建</span><br><span class="line">var emitter = game.add.emitter(game.width/2, game.height/2, 50);//(x坐标, y坐标, 粒子在屏幕上显示的最大数量)</span><br><span class="line"></span><br><span class="line">//创建粒子</span><br><span class="line">emitter.makeParticles(&apos;bubble&apos;, [0,1,2,3,4,5,6,7], 1000, true, true);//(名称, 可用帧（随机调用）, 要产生多少粒子, 粒子之间/粒子跟边界是否碰撞)</span><br><span class="line"></span><br><span class="line">//粒子的控制</span><br><span class="line">emitter.setXSpeed(500, 1000);//X轴控制速度(min?, max?) 负值先左正值向右</span><br><span class="line">emitter.setXSpeed(500, 1000);//Y轴控制速度(min?, max?)</span><br><span class="line">emitter.setScale(0, 1, 0, 1, 3000);//缩放 (minX?, maxX?, minY?, maxY?, rate?) rate：最小值过渡到最大值的时间</span><br><span class="line">emitter.setAlpha(0, 1, 3000);//透明度 (min?, max?, rate?, ease?)</span><br><span class="line">emitter.setRotation(100, 200); //角速度,自身旋转的速度 (min?, max?)</span><br><span class="line"></span><br><span class="line">//物理引擎</span><br><span class="line">emitter.gravity = 600; //重力</span><br><span class="line">emitter.bounce.y = 0.8; //弹跳</span><br><span class="line"></span><br><span class="line">//发射粒子</span><br><span class="line">emitter.start(false, 3000, 1000, 50);//(是否一次发射所有粒子如为false则一次发射一个, 粒子生存时间, 多久发射一次, 有多少粒子需要发射默认50 )</span><br><span class="line"></span><br><span class="line">//发射粒子方法2 可无限发射</span><br><span class="line">emitter.flow(3000, 1000, 10, -1); //(粒子生存周期0为永远不会消失, 多久发射一次, 每一次发射多少粒子, 总共有多少粒子可以发射-1位无限)</span><br><span class="line"></span><br><span class="line">//update</span><br><span class="line">game.physice.arcade.collide(emitter); //每一帧进行碰撞检测</span><br></pre></td></tr></table></figure>
<h2 id="Tiled-瓦片地图"><a href="#Tiled-瓦片地图" class="headerlink" title="Tiled 瓦片地图"></a>Tiled 瓦片地图</h2><blockquote>
<p>制作工具 <a href="http://www.mapeditor.org/" target="_blank" rel="noopener">http://www.mapeditor.org/</a></p>
</blockquote>
<ul>
<li>添加瓦片图集</li>
<li>新建图层 设置图块大小</li>
<li>构建地图 可使用图章和油漆桶工具，填充错误可使用橡皮擦工具，按ctrl可连续选中图集</li>
<li>导出地图 选择json</li>
</ul>
<h2 id="使用tiled-瓦片地图"><a href="#使用tiled-瓦片地图" class="headerlink" title="使用tiled 瓦片地图"></a>使用tiled 瓦片地图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//preload</span><br><span class="line">game.load.tilemap(&apos;mario_map&apos;, &apos;asset/tilemap/mario.json&apos;, null, Phaser.Tilemap.TILED_JSON);//(资源名称, 资源json地址, null, 格式)</span><br><span class="line">game.load.image(&apos;mario&apos;, &apos;asset/tilemap/mario.png&apos;);//加载瓦片图片集合</span><br><span class="line"></span><br><span class="line">//create</span><br><span class="line">var map = game.add.tilemap(&apos;mario_map&apos;); //(资源名称) 创建瓦片地图</span><br><span class="line"></span><br><span class="line">map.addTilesetImage(&apos;super_mario&apos;, &apos;mario&apos;); //添加瓦片地图集合(Tiled软件中瓦片集合名称, 瓦片集合图片资源名称)</span><br><span class="line"> </span><br><span class="line">var layer = map.createLayer(&apos;world&apos;); //创建层 (Tiled软件中层的名字)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>动态修改瓦片地图</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//create</span><br><span class="line">//注意，所有参数已瓦片为单位不是像素，从0开始</span><br><span class="line">//获取指定位置上的瓦片 </span><br><span class="line">var tile = map.getTile(0, 24);</span><br><span class="line">//在指定位置设置指定的瓦片</span><br><span class="line">map.putTile(tile, 0, 0);</span><br><span class="line">//在指定区域填充指定的瓦片 （瓦片集合索引，开始位置x,y, 结束位置x,y）</span><br><span class="line">map.fill(12, 0, 0, 20, 20);</span><br><span class="line"></span><br><span class="line">//瓦片的复制与粘贴</span><br><span class="line">var tiles = map.copy(0, 19, 5, 5);</span><br><span class="line">map.paste(0, 0, tiles);</span><br><span class="line"></span><br><span class="line">//在指定区域内用一种瓦片替换另一种瓦片 前两个参数为集合索引，后四个为矩形区域，不指定区域替换所有</span><br><span class="line">map.replace(1, 12, 0, 0, 10, 10);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>瓦片地图碰撞检测</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tilemap.setCollision(indexes, collides?, layer?); //(可以是一个数组瓦片集合索引, 是否进行碰撞检测, 在哪个层进行碰撞检测)</span><br><span class="line"></span><br><span class="line">tilemap.setCollisionBetween(start, stop, collides?, layer?);//(瓦片集合索引开始, 瓦片集合索引结束, 是否进行碰撞检测, 在哪个层进行碰撞检测)</span><br></pre></td></tr></table></figure>
<p>实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//create</span><br><span class="line">//设置需要碰撞的瓦片</span><br><span class="line">map.setCollisionBetween(15,16);</span><br><span class="line">map.setCollisionBetween(20,25);</span><br><span class="line"></span><br><span class="line">map.setCollision(40);</span><br><span class="line"></span><br><span class="line">//设置要碰撞的瓦片从1开始</span><br><span class="line">map.setCollision([20,21,26,27,15,23,38, 39,40]);</span><br><span class="line">//排除要碰撞的瓦片</span><br><span class="line">map.setCollisionByExclusion([7, 32, 35, 36, 47]);</span><br><span class="line">//针对gameLayer这个层进行碰撞检测，即别的层不受影响</span><br><span class="line">map.setCollisionBetween(1, 40, true, gameLayer);</span><br><span class="line"></span><br><span class="line">//启用物理引擎</span><br><span class="line">game.physics.startSystem(Phaser.physics.ARCADE);</span><br><span class="line"></span><br><span class="line">//update</span><br><span class="line">game.physics.arcade.collide(player, layer);//碰撞检测</span><br><span class="line">//角色与地图图层接触后该方法返回true</span><br><span class="line">player.body.onFloor()</span><br></pre></td></tr></table></figure>
<h2 id="事件系统Phaser-Signal"><a href="#事件系统Phaser-Signal" class="headerlink" title="事件系统Phaser.Signal"></a>事件系统Phaser.Signal</h2><blockquote>
<p>Signal对象的创建</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var signal = new Phaser.Signal();</span><br><span class="line"></span><br><span class="line">//添加事件监听器</span><br><span class="line">signal.add(listener, listenerContext?, priority?, args?, args?, args?....);//(函数, 函数上下文, 优先度, 参数可以有多个)</span><br><span class="line"></span><br><span class="line">//添加事件监听器 只执行一次</span><br><span class="line">signal.addOnce(listener, listenerContext?, priority?, args?, args?, args?....);</span><br><span class="line"></span><br><span class="line">//移除单个事件监听器</span><br><span class="line">signal.remove(listener);</span><br><span class="line"></span><br><span class="line">//移除该signal对象上的所有事件监听器</span><br><span class="line">signal.removeAll();</span><br><span class="line"></span><br><span class="line">//向所有该signal对象上的监听器分发事件</span><br><span class="line">signal.dispatch(params?);</span><br><span class="line"></span><br><span class="line">//注销signal对象 注销后不会再分发事件 相应内存也会被释放</span><br><span class="line">signal.dispose();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一些重要的系统事件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">var game = new Phaser.Game();</span><br><span class="line"></span><br><span class="line">//onBlur, onFocus, onPause, onResume 都是game对象的一个属性，但代表的都是一个signal对象</span><br><span class="line">game.onBlur //游戏失去焦点</span><br><span class="line">game.onFocus //游戏获得焦点</span><br><span class="line">game.onPause //游戏暂停事件</span><br><span class="line">game.onResume //游戏恢复事件</span><br><span class="line"></span><br><span class="line">//给onPause添加一个事件监听器</span><br><span class="line">game.onPause.add(function()&#123;</span><br><span class="line">    alert(&apos;游戏已暂停&apos;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//scale对象</span><br><span class="line">game.scale.onFullScreenChange //当进入或退出全屏时</span><br><span class="line">game.scale.onOrientationChange //当设备横竖屏切换时</span><br><span class="line">game.scale.onSizeChange //当游戏尺寸改变时</span><br><span class="line"></span><br><span class="line">//资源加载中的一些事件</span><br><span class="line">game.load.onFileComplete //当一个文件加载完成时</span><br><span class="line">game.load.onFileError //当一个文件加载失败时</span><br><span class="line">game.load.onFileStart //当一个文件开始加载时</span><br><span class="line">game.load.onLoadComplete //当所有资源加载完成时</span><br><span class="line"></span><br><span class="line">//补间动画中的一些事件</span><br><span class="line">tween.onStart</span><br><span class="line">tween.onComplete</span><br><span class="line">tween.onLoop</span><br><span class="line">tween.onRepeat</span><br><span class="line"></span><br><span class="line">//关键帧动画事件</span><br><span class="line">animation.onStart</span><br><span class="line">animation.onComplete</span><br><span class="line">animation.onLoop</span><br><span class="line">animation.onUpdate //动画帧变化时</span><br></pre></td></tr></table></figure>
<h2 id="用户交互管理对象-Phaser-Input"><a href="#用户交互管理对象-Phaser-Input" class="headerlink" title="用户交互管理对象 Phaser.Input"></a>用户交互管理对象 Phaser.Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var game = new Phaser.Game();</span><br><span class="line"></span><br><span class="line">//使用游戏实例对象的input属性来引用当前的用户交互管理对象</span><br><span class="line">game.input // =&gt; new Phaser.Input(game)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>基本属性和方法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">game.input.onDown //按下事件</span><br><span class="line">game.input.onUp //离开事件</span><br><span class="line">game.input.onTap //轻击事件</span><br><span class="line">game.input.onHold //长按事件</span><br><span class="line"></span><br><span class="line">//添加鼠标或手指移动事件侦听器</span><br><span class="line">game.input.addMoveCallback(callback, context);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//删除鼠标或手指移动事件侦听器</span><br><span class="line">game.input.deleteMoveCallback(callback, context);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Pointer对象</p>
</blockquote>
<p>代表一个指针对象，可以是鼠标，手指或其他输入设备。多点触摸会出现多个Pointer对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var game = new Phaser.Game();</span><br><span class="line"></span><br><span class="line">//获取最近一次激活的pointer对象</span><br><span class="line">var pointer = game.input.activePointer;</span><br><span class="line"></span><br><span class="line">pointer.clientX //指针事件发生时的x坐标</span><br><span class="line">pointer.clientY //指针事件发生时的Y坐标</span><br><span class="line"></span><br><span class="line">pointer.isDown //用来判断指针是否在按下状态</span><br><span class="line">pointer.isUp //用来判断指针是否在释放状态</span><br></pre></td></tr></table></figure>
<blockquote>
<p>鼠标对象</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取鼠标对象</span></span><br><span class="line"><span class="keyword">var</span> mouse = game.input.mouse;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取为鼠标定制的Pointer对象</span></span><br><span class="line"><span class="keyword">var</span> mousePointer = game.input.mousePointer</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置鼠标滚轮事件的回调函数</span></span><br><span class="line">mouse.mouseWheelCallback</span><br><span class="line"><span class="comment">//鼠标滚轮的滚动方向，1为向上， -1为向下</span></span><br><span class="line">mouse.wheelDelta</span><br><span class="line"></span><br><span class="line">mousePointer.leftButton <span class="comment">//鼠标左键对象</span></span><br><span class="line">mousePointer.middleButton <span class="comment">//鼠标中键对象</span></span><br><span class="line">mousePointer.rightButton <span class="comment">//鼠标右键对象</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>键盘对象</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> game = <span class="keyword">new</span> Phaser.Game();</span><br><span class="line"><span class="comment">//获取键盘对象</span></span><br><span class="line"><span class="keyword">var</span> keyboard = game.input.keyboard;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加按键回调 所有按键</span></span><br><span class="line">keyboard.addCallbacks(context, onDown, onUp, onPress)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个键对象</span></span><br><span class="line"><span class="keyword">var</span> key = keyboard.addKey(keycode) <span class="comment">//=&gt;返回Phaser.Key对象 keycode文档中查找</span></span><br><span class="line"><span class="comment">//创建一个包含上下左右方向键的对象</span></span><br><span class="line">keyboard.createCursorKeys()</span><br><span class="line"></span><br><span class="line">key.isDown <span class="comment">//用来判断该键是否处于按下状态</span></span><br><span class="line">key.isUp  <span class="comment">//用来判断该键是否处于释放状态</span></span><br><span class="line">key.onDown <span class="comment">//键按下时的Signal对象</span></span><br><span class="line">key.onUp  <span class="comment">//键释放时的Signal对象</span></span><br><span class="line"></span><br><span class="line">key.altKey <span class="comment">//判断是否alt键也被同时按下</span></span><br><span class="line">key.ctrlKey <span class="comment">//判断是否ctrl键也被同时按下</span></span><br><span class="line">key.shiftKey <span class="comment">//判断是否shift键也被同时按下</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>实例 - 画笔</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.create = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    graphics = game.add.graphics(<span class="number">0</span>, <span class="number">0</span>); <span class="comment">//创建图形对象</span></span><br><span class="line">    </span><br><span class="line">    game.input.onDown.add(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//指针按下时</span></span><br><span class="line">        graphics.beginFill(<span class="number">0xffffff</span>);<span class="comment">//设置填充样式</span></span><br><span class="line">        draw();</span><br><span class="line">        game.input.addMoveCallback(draw);<span class="comment">//添加指针移动回调函数</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    game.input.onUp.add(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">        game.input.deleteMoveCallback(draw); <span class="comment">//删除指针移动回调函数</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pointer = game.input.activePointer;</span><br><span class="line">    graphics.drawCircle(pointer.x, pointer.y, <span class="number">10</span>); <span class="comment">//绘制直径为10的圆</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实例 - 键盘</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> rightKey;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.create = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//添加按键</span></span><br><span class="line">    rightKey = game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);<span class="comment">//右方向键 其他常量 UP DOWN LEFT</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.update = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(upKey.isDown)&#123;</span><br><span class="line">        sprite.y--;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(otherKey.isDown)&#123;</span><br><span class="line">    otherCode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="特定游戏对象的交互事件处理-Phaser-Events"><a href="#特定游戏对象的交互事件处理-Phaser-Events" class="headerlink" title="特定游戏对象的交互事件处理 Phaser.Events"></a>特定游戏对象的交互事件处理 Phaser.Events</h2><p>input的为全局 events为特定对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var game = new Phaser.Game();</span><br><span class="line">var sprite = game.add.sprite();</span><br><span class="line">sprite.inputEnabled = true; //开启输入事件</span><br><span class="line">//获取该游戏对象的Phaser.Events对象</span><br><span class="line">var events = sprite.events;</span><br><span class="line"></span><br><span class="line">events.onInputDown; //当指针在该对象上按下时的事件（signal）</span><br><span class="line">events.onInputUp; //当指针在该对象上释放时的事件（signal）</span><br><span class="line">events.onInputOver; //当指针进入该对象时的事件（signal）</span><br><span class="line">events.onInputOut; //当指针离开该对象时的事件（signal）</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Phaser.InputHandler对象 拖动对象</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var game = new Phaser.Game();</span><br><span class="line">var sprite = game.add.sprite();</span><br><span class="line">sprite.inputEnabled = true; //开启输入事件</span><br><span class="line">//获取该游戏对象的Phaser.InputHandler对象</span><br><span class="line">var InputHandler = sprite.input;</span><br><span class="line"></span><br><span class="line">inputHandler.enableDrag() //使对象能拖动</span><br><span class="line">inputHandler.disableDrag() //禁用拖动</span><br><span class="line"></span><br><span class="line">inputHandler.pointerOver() //判断指针是否在该对象之内</span><br><span class="line">inputHandler.pointerOut() //判断指针是否在该对象之外</span><br><span class="line">inputHandler.pointerX() //当指针在该对象之内时相对于该对象的X坐标</span><br><span class="line">inputHandler.pointerY() //当指针在该对象之内时相对于该对象的y坐标</span><br><span class="line"></span><br><span class="line">//当设置该值为true时,</span><br><span class="line">//在单击或拖动该对象时它会自动位于显示列表的最上方</span><br><span class="line">inputHandler.bringToTop</span><br></pre></td></tr></table></figure>
<h2 id="音频处理-Phaser-SoundManager"><a href="#音频处理-Phaser-SoundManager" class="headerlink" title="音频处理 Phaser.SoundManager"></a>音频处理 Phaser.SoundManager</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var game = new Phaser.Game();</span><br><span class="line"></span><br><span class="line">var soundManager = game.sound; //获取SoundManager对象</span><br><span class="line"></span><br><span class="line">//game.add.audio()方法返回的就是一个Phaser.Sound对象</span><br><span class="line">var sound = game.add.audio(key, volume?, loop?); //(资源名称, 音量大小0~1, 是否循环)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>音频资源的加载</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">game.load.audio(key, urls, autoDecode?); //(资源名称, 资源地址, 是否自动解码(true));</span><br><span class="line"></span><br><span class="line">game.load.audio(&apos;foo&apos;, &apos;foo.mp3&apos;); //字符串形式</span><br><span class="line"></span><br><span class="line">game.load.audio(&apos;foo&apos;, [&apos;foo.ogg&apos;, &apos;foo.wav&apos;, &apos;foo.mp3&apos;]); //数组形式</span><br></pre></td></tr></table></figure>
<blockquote>
<p>audio sprite</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">game.load.sudiosprite(key, urls, jsonURL?, jsonDate?, autoDecode?);// jsonUrl,jsonDate 二选一</span><br></pre></td></tr></table></figure>
<p>audio sprite 数据生成工具<br><a href="https://github.com/tonistiigi/audiosprite" target="_blank" rel="noopener">https://github.com/tonistiigi/audiosprite</a></p>
<figure class="highlight plain"><figcaption><span>--autoplay bg_loop --output mygameaudio bg_loop.wav *.mp3```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 实例</span><br></pre></td></tr></table></figure>
<p>\preload</p>
<p>\单一音频<br>game.load.audio(‘sound1’, ‘asset/audio/1.mp3’);</p>
<p>\音频sprite<br>game.load.audiosprite(‘audiosprite’, [<br>    ‘asset/audio/maudiosprite.ogg’,<br>    ‘asset/audio/maudiosprite.m4a’,<br>    ‘asset/audio/maudiosprite.mp3’,<br>    ‘asset/audio/maudiosprite.ac3’],<br>    ‘asset/audio/maudiosprite.json’,);</p>
<p>\create<br>var sound = game.add.audio(‘sound1’);<br>var audiosprite = game.add.audioSprite(‘audiosprite’);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 音频资源的使用和管理</span><br><span class="line"></span><br><span class="line">&gt; 播放控制</span><br></pre></td></tr></table></figure></p>
<p>sound.play(marker?, position?, volume?, loop?, forceRestart?);<br>//marker 标注名称<br>//position 播放位置<br>//volume 音量 0~1<br>//loop 是否循环<br>//forceRestart 是否强制重新开始</p>
<p>sound.pause(); //暂停播放<br>sound.resume(); //恢复播放<br>sound.stop(); //停止播放</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 分段标注</span><br></pre></td></tr></table></figure>
<p>//标注声音<br>sound.addMarker(name, start, duration, volume?, loop?);<br>//name 资源名称<br>//start 开始时间 秒<br>//duration 持续时间 秒<br>//volume 音量大小<br>//loop 循环</p>
<p>sound.play(name); //播放标注的声音</p>
<p>sound.removeMarker(name); //移除标注<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 声音的淡入淡出</span><br></pre></td></tr></table></figure></p>
<p>//淡入<br>sound.fadeIn(duration?, loop?, marker?);<br>//duration 持续时间 毫秒<br>//替代sound.play</p>
<p>//淡出<br>sound.fadeOut(duration?);<br>//自定义<br>sound.fadeTo(duration?, volume?);<br>volume 过渡到的音量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 声音事件相关的Signal对象</span><br></pre></td></tr></table></figure></p>
<p>sound.onPlay<br>sound.onPause<br>sound.onResume<br>sound.onStop<br>sound.onFadeComplete //淡入淡出完成时<br>sound.onMarkerComplete //某一段标注的声音播放完成时<br>sound.onLoop<br>sound.onMute //静音时<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ex</span><br></pre></td></tr></table></figure></p>
<p>sound.onPlay.add(function(){<br>    alert(‘Play’);<br>})<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 物理引擎</span><br><span class="line"></span><br><span class="line">&gt; 开启物理引擎</span><br></pre></td></tr></table></figure></p>
<p>\Phaser默认使用ARCADE物理引擎，所以可以不写下面这句<br>game.physics.startSystem(Phaser.Physics.ARCADE);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 在游戏精灵上启用物理引擎</span><br></pre></td></tr></table></figure></p>
<p>game.physics.enable(sprite, Phaser.Physics.ARCADE);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 在组中启用物理引起</span><br><span class="line"></span><br><span class="line">为组中的没一个子元素启用物理引擎</span><br></pre></td></tr></table></figure></p>
<p>group.enableBody = true;</p>
<p>//指定物理引擎<br>group.physicsBodyType = Phaser.Physics.AARCADE;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 精灵的body对象</span><br><span class="line"></span><br><span class="line">当精灵启用物理引擎后，就会拥有一个body属性，物理属性都是附加在精灵的body对象上的。</span><br></pre></td></tr></table></figure></p>
<p>sprite.body;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; body属性</span><br><span class="line"></span><br><span class="line">速度</span><br></pre></td></tr></table></figure></p>
<p>sprite.body.velocity = new Phaser.Point(100, 100); //(x, y) x为横向运动，正值向右，负值向左</p>
<p>//OR<br>sprite.body.velocity.set(100); //(x,y)如果只传一个参数，说明x和y都是这个值</p>
<p>//OR<br>sprite.body.velocity.x = 100;<br>sprite.body.velocity.y = 100;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">加速度</span><br></pre></td></tr></table></figure></p>
<p>sprite.body.acceleration = new Phaser.Point(100, 100); </p>
<p>//OR<br>sprite.body.acceleration.set(100); </p>
<p>//OR<br>sprite.body.acceleration.x = 100;<br>sprite.body.acceleration.y = 100;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">角速度和角速度的加速度</span><br></pre></td></tr></table></figure></p>
<p>sprite.body.angularVelocity = 90; //正数顺时针旋转，负数为逆时针旋转 单位：度/秒</p>
<p>sprite.body.angularAcceleration = 45;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">阻力</span><br></pre></td></tr></table></figure></p>
<p>sprite.body.drap = new Phaser.Point(100, 100); </p>
<p>//OR<br>sprite.body.drap.set(100); </p>
<p>//OR<br>sprite.body.drap.x = 100;<br>sprite.body.drap.y = 100;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">重力</span><br></pre></td></tr></table></figure>
<p>sprite.body.gravity = new Phaser.Point(100, 100); </p>
<p>//OR<br>sprite.body.gravity.set(100); </p>
<p>//OR<br>sprite.body.gravity.x = 100;<br>sprite.body.gravity.y = 100;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">弹跳 0~1</span><br></pre></td></tr></table></figure></p>
<p>sprite.body.bounce = new Phaser.Point(0.5, 0.5); </p>
<p>//OR<br>sprite.body.bounce.set(0.5); </p>
<p>//OR<br>sprite.body.bounce.x = 0.5;<br>sprite.body.bounce.y = 0.5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">OTHER</span><br></pre></td></tr></table></figure>
<p>sprite.body.friction.set(100); //设置与其他物体接触时的摩擦力<br>sprite.body.rotation = Math.PI; //设置角度<br>sprite.body.immovable = true; //设置该物体是否时固定的<br>sprite.body.mass = 10; //设置物体的相对质量, 默认为1<br>sprite.body.maxVelocity.set(100, 200); //设置最大速度<br>sprite.maxAngular = 1000; //设置最大角速度</p>
<p>sprite.body.setSize(width, height, offsetX, offsetY); //设置body范围大小<br>sprite.body.reset(x, y);//重置所有物理属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### Arcade引擎提供的一些静态方法</span><br><span class="line">以指定的速度运动到目的地(返回到目的地的角度)</span><br></pre></td></tr></table></figure>
<p>game.physics.arcade.moveToXY(sprite, x, y, speed);<br>game.physics.arcade.moveToObject(sprite, destination, speed);<br>game.physics.arcade.moveToPointer(sprite, speed, potinter);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">以指定的加速度运动到目的地</span><br></pre></td></tr></table></figure></p>
<p>game.physics.arcade.accelerateToXY(sprite, x, y, speed);<br>game.physics.arcade.accelerateToObject(sprite, destination, speed);<br>game.physics.arcade.accelerateToPointer(sprite, speed, potinter);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">一些工具</span><br></pre></td></tr></table></figure></p>
<p>//计算角度<br>game.physics.arcade.angleBetween(source, target);<br>game.physics.arcade.angleToPointer(displayObject, pointer);<br>game.physics.arcade.angleToXY(displayObject, x, y);</p>
<p>//计算距离<br>game.physics.arcade.distanceBetween(source, target);<br>game.physics.arcade.distanceToPointer(displayObject, pointer);<br>//计算速度<br>game.physics.arcade.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 碰撞检测</span><br><span class="line"></span><br><span class="line">overlap方法 只是检测不产生物理效果 需使用在update方法中</span><br></pre></td></tr></table></figure></p>
<p>game.physics.arcade.overlap(sprite1, sprite2, function(){console.log(‘It is overlap!’)});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collide方法 产生物理效果 需使用在update方法中，对象可以是精灵或组</span><br></pre></td></tr></table></figure></p>
<p>game.physics.arcade.collide(sprite1, sprite2, function(){console.log(‘It is collide!’)});</p>
<p>game.physics.arcade.collide(sprite, group);</p>
<p>game.physics.arcade.collide(group); //组内碰撞检测<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">与游戏边界进行碰撞检测</span><br></pre></td></tr></table></figure></p>
<p>sprite.body.collideWorldBounds = true;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## debug</span><br><span class="line">显示FPS</span><br></pre></td></tr></table></figure></p>
<p>//preload<br>game.time.advancedTiming = true;</p>
<p>//render<br>game.debug.text(game.time.fps, 32, 320, “#00ff00”);<br><code>`</code></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/06/28/webpack学习手记/" class="prev">PREV</a><a href="/2017/05/18/MongoDB学习手记/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ma-chen-cn';
var disqus_identifier = '2017/05/27/Phaser学习手记/';
var disqus_title = 'Phaser学习手记';
var disqus_url = 'http://bigma.cc/2017/05/27/Phaser学习手记/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ma-chen-cn.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2023 <a href="http://bigma.cc">大马</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>. <a href="https://beian.miit.gov.cn/" target="_blank">冀ICP备13002956号-1</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-116335564-1",'auto');ga('send','pageview');</script></body></html>