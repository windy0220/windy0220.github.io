<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 使用Jenkins实现自动化部署 · 大马的个人网站</title><meta name="description" content="使用Jenkins实现自动化部署 - 大马"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://bigma.cc/atom.xml" title="大马的个人网站"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avater.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">日志</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/1000/01/01/实验室/" target="_self" class="nav-list-link">实验室</a></li><li class="nav-list-item"><a href="http://weibo.com/80yang" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/windy0220" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">使用Jenkins实现自动化部署</h1><div class="post-info">2018年7月5日</div><div class="post-content"><p>系统环境为阿里云 CentOS 8.0</p>
<h4 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class="line"></span><br><span class="line">sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class="line"></span><br><span class="line">yum install jenkins</span><br></pre></td></tr></table></figure>
<h4 id="Jenkins-依赖JAVA-如果没有需要安装"><a href="#Jenkins-依赖JAVA-如果没有需要安装" class="headerlink" title="Jenkins 依赖JAVA 如果没有需要安装"></a>Jenkins 依赖JAVA 如果没有需要安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查时否安装</span></span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line"><span class="comment"># centOS 需要安装 openjdk 的java ,搜索可用的包</span></span><br><span class="line">yum search openjdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">yum install java-1.8.0-openjdk</span><br></pre></td></tr></table></figure>
<h4 id="启动-Jenkins"><a href="#启动-Jenkins" class="headerlink" title="启动 Jenkins"></a>启动 Jenkins</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo service jenkins start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 守护程序</span></span><br><span class="line">sudo chkconfig jenkins on</span><br></pre></td></tr></table></figure>
<p>Jenkins 将启动在 8080 端口</p>
<h4 id="Nginx-反向代理设置"><a href="#Nginx-反向代理设置" class="headerlink" title="Nginx 反向代理设置"></a>Nginx 反向代理设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name example.com; # 这里配置域名</span><br><span class="line">  access_log off;</span><br><span class="line">  index index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line">  #error_page 404 /404.html;</span><br><span class="line">  #error_page 502 /502.html;</span><br><span class="line"></span><br><span class="line">  location /&#123;</span><br><span class="line">    proxy_pass  http://localhost:8080/;</span><br><span class="line">    proxy_redirect      http://localhost:8080 $scheme://example.com;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_set_header Host $http_host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header X-NginX-Proxy true;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重启 nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><h5 id="反向代理设置有误"><a href="#反向代理设置有误" class="headerlink" title="反向代理设置有误"></a>反向代理设置有误</h5><p>解决办法：</p>
<ul>
<li>打开浏览器进入 Jenkins</li>
<li>系统管理 -&gt; 系统设置 -&gt; Jenkins URL</li>
<li>在域名后面加上 :8080</li>
</ul>
<h5 id="不推荐使用-JNLP3-connect-协议"><a href="#不推荐使用-JNLP3-connect-协议" class="headerlink" title="不推荐使用 JNLP3-connect 协议"></a>不推荐使用 JNLP3-connect 协议</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This Jenkins instance uses deprecated protocols: JNLP3-connect. It may impact stability of the instance. If newer protocol versions are supported by all system components (agents, CLI and other clients), it is highly recommended to disable the deprecated protocols. See Protocol Configuration.</span><br></pre></td></tr></table></figure>
<p>意思是 Jenkins 不推荐使用 JNLP3-connect 协议，会影响实例的稳定性。如果所有系统组件（代理，CLI和其他客户端）都支持较新的协议版本，则强烈建议禁用已弃用的协议。</p>
<p>解决办法：</p>
<p>系统管理 -&gt;<br>全局安全配置 -&gt;<br>点击代理中的代理协议 -&gt;<br>取消<br><code>Java Web Start Agent Protocol/1</code><br><code>Java Web Start Agent Protocol/2</code><br><code>Java Web Start Agent Protocol/3</code> 前面的勾  -&gt;<br>保存</p>
<p><img src="https://note.youdao.com/yws/public/resource/aafab269782ca7bc084c5c7518a8a61e/xmlnote/2AB3785390634998944FC2F9322C92EF/2383" alt="image"></p>
<h5 id="执行-Shell-脚本权限不够的问题"><a href="#执行-Shell-脚本权限不够的问题" class="headerlink" title="执行 Shell 脚本权限不够的问题"></a>执行 Shell 脚本权限不够的问题</h5><p>有时部署时需要用到 Shell 命令，Jenkins是没有权限执行的。</p>
<p>解决办法：</p>
<ul>
<li><p>修改Jenkins配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/jenkins</span><br><span class="line"><span class="comment"># 修改 $JENKINS_USER 为 root</span></span><br><span class="line"><span class="variable">$JENKINS_USER</span>=<span class="string">"root"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置相关权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chown -R root:root /var/lib/jenkins</span><br><span class="line">chown -R root:root /var/cache/jenkins</span><br><span class="line">chown -R root:root /var/<span class="built_in">log</span>/jenkins</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启服务并检查权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启 jenkins 服务</span></span><br><span class="line">service jenkins restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查权限</span></span><br><span class="line">ps -ef | grep jenkins</span><br></pre></td></tr></table></figure></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/07/18/media-媒体查询分辨率收集及使用说明/" class="prev">PREV</a><a href="/2018/06/03/Sass/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ma-chen-cn';
var disqus_identifier = '2018/07/05/使用Jenkins实现自动化部署/';
var disqus_title = '使用Jenkins实现自动化部署';
var disqus_url = 'http://bigma.cc/2018/07/05/使用Jenkins实现自动化部署/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ma-chen-cn.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2023 <a href="http://bigma.cc">大马</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>. <a href="https://beian.miit.gov.cn/" target="_blank">冀ICP备13002956号-1</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-116335564-1",'auto');ga('send','pageview');</script></body></html>